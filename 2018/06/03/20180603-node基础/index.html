<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="-Node," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Node出来了这么久，我到现在都还没明白它是为啥出来的，到底为了解决什么问题，怎么用，什么情况下要用，工作也快一年了，感觉自己并没有什么长进，所以想下定决心好好看看Node到底是个什么神奇的东西，虽然现在还没用过，至少别人问起来能说一两句">
<meta property="og:type" content="article">
<meta property="og:title" content="Node基础">
<meta property="og:url" content="http://yy709593266.github.io/blog/2018/06/03/20180603-node基础/index.html">
<meta property="og:site_name" content="袁媛-仙女很忙">
<meta property="og:description" content="Node出来了这么久，我到现在都还没明白它是为啥出来的，到底为了解决什么问题，怎么用，什么情况下要用，工作也快一年了，感觉自己并没有什么长进，所以想下定决心好好看看Node到底是个什么神奇的东西，虽然现在还没用过，至少别人问起来能说一两句">
<meta property="og:image" content="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180619_1.png">
<meta property="og:image" content="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180702_13.png">
<meta property="og:image" content="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180702_14.png">
<meta property="og:image" content="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180703_16.png">
<meta property="og:image" content="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180708_18.png">
<meta property="og:image" content="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180709_19.png">
<meta property="og:image" content="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180711_23.png">
<meta property="og:image" content="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180719_1.png">
<meta property="og:image" content="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180719_2.png">
<meta property="og:updated_time" content="2018-07-31T14:14:37.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Node基础">
<meta name="twitter:description" content="Node出来了这么久，我到现在都还没明白它是为啥出来的，到底为了解决什么问题，怎么用，什么情况下要用，工作也快一年了，感觉自己并没有什么长进，所以想下定决心好好看看Node到底是个什么神奇的东西，虽然现在还没用过，至少别人问起来能说一两句">
<meta name="twitter:image" content="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180619_1.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yy709593266.github.io/blog/2018/06/03/20180603-node基础/"/>

  <title> Node基础 | 袁媛-仙女很忙 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">袁媛-仙女很忙</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">仙女也要码砖不像话</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Node基础
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-06-03T21:47:09+08:00" content="2018-06-03">
              2018-06-03
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><code>Node</code>出来了这么久，我到现在都还没明白它是为啥出来的，到底为了解决什么问题，怎么用，什么情况下要用，工作也快一年了，感觉自己并没有什么长进，所以想下定决心好好看看<code>Node</code>到底是个什么神奇的东西，虽然现在还没用过，至少别人问起来能说一两句<a id="more"></a></p>
<h3 id="Node出现背景"><a href="#Node出现背景" class="headerlink" title="Node出现背景"></a><code>Node</code>出现背景</h3><h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>http请求由客户端（浏览器，app…）发送请求到服务器（<code>apache</code>，<code>tomcat</code>，<code>IIS</code>…），服务器从数据库（<code>mysql</code>，<code>oracle</code>…）拿取数据，或将数据存入数据库（数据传输<code>I／O</code>），服务器拿到数据以后对数据进行解析并传给客户端页面展示。我们想要做的优化就是要缩短客户端发送请求到接收请求之间的时间，是提升web服务器性能的关键。<br>平常开发的过程中，发送请求越快当然时长越短，但是这个请求快慢我们没法控制，因为这个直接由用户的网速决定；<br>所以我们只能着手控制服务器，可以提高服务器带宽，或者DNS加速的方式来加速响应速度，请求时长自然会缩短，但是由于成本也不会无上限的提高带宽；<br>还有就是通过代码的算法更加优秀来让响应速度更快，这个就取决于程序猿们了；<br>设计模式上使用多线程，即发送一个请求就开启一个线程，但是也不是越多越好，会占内存，可能造成内存阻塞，因此线程数也要做合理的限制。例如：饭店来一个客户就有一个服务员一对一服务，来一万个就有一万个服务员一对一服务，两个客户之间不会有冲突，虽然服务员能一对一服务，但是客户来吃饭，点餐，厨师只有一百个，这里就崩了，也就是服务器和数据库之间<code>I／O</code>阻塞了，因为数据库从磁盘中读取数据的速度都是有上限的。很多大型的项目，在后期都会遇到这种<code>I／O</code>阻塞问题，现在有很多解决方式（分布式…优化磁盘读取），但是无论如何优化，磁盘的读取都是有上限，任务巨多的时候还是会<code>I／O</code>阻塞。Ryan Dahl（<code>Node</code>爸比）的工作就是写高性能的web服务，对于高性能，异步<code>I／O</code>、事件驱动是基本原则，但是用C/C++写就太痛苦了。于是他开始设想用高级语言开发Web服务。他评估了很多种高级语言，发现很多语言虽然同时提供了同步<code>I／O</code>和异步<code>I／O</code>，但是开发人员一旦用了同步<code>I／O</code>，他们就再也懒得写异步<code>I／O</code>了，所以，最终，<code>Node</code>爸比选择了JavaScript，因为JavaScript是单线程（所以，<code>Node</code>也是）执行，根本不能进行同步<code>I／O</code>操作，JavaScript的这一“缺陷”导致了它只能使用异步<code>I／O</code>。</p>
<h4 id="三大特点"><a href="#三大特点" class="headerlink" title="三大特点"></a>三大特点</h4><p><code>Node</code>的三大特点就是如何解决服务器高性能瓶颈问题：单线程，非阻塞<code>I／O</code>以及事件驱动。具体怎么理解这三个特点呢？</p>
<h5 id="单线程"><a href="#单线程" class="headerlink" title="单线程"></a>单线程</h5><p><code>Node</code>不为每个客户连接创建新的线程，仅仅使用一个线程，当有用户连接就触发一个内部事件，通过非阻塞<code>I／O</code>和事件驱动机制让整个程序宏观上并行。这样操作系统不再有创建和销毁线程的时间开销了。</p>
<h5 id="非阻塞I／O"><a href="#非阻塞I／O" class="headerlink" title="非阻塞I／O"></a>非阻塞<code>I／O</code></h5><p>要说什么是非阻塞<code>I／O</code>首先要知道什么是阻塞<code>I／O</code>：<br>当在访问数据库取得数据的时候，传统的单线程机制整个线程将暂停下来，等待数据库返回结果才能执行后面的代码，也就是<code>I／O</code>阻塞了代码的执行。<br><code>Node</code>采用了非阻塞<code>I／O</code>机制，在执行了访问数据库的代码之后将立即转而执行后面的代码，把数据库返回结果的处理代码放在回调函数中。<br>当某个<code>I／O</code>执行完毕，将以事件的形式通知执行<code>I／O</code>操作的线程执行回调函数。</p>
<h5 id="事件驱动"><a href="#事件驱动" class="headerlink" title="事件驱动"></a>事件驱动</h5><p>客户端请求建立连接，提交数据等行为会出发相应的事件，<code>Node</code>一个时刻只能执行一个事件回调函数，但是在执行一个事件回调函数的中途可以转而处理其他事件（比如又有新用户建立连接了）然后返回继续执行原事件的回调函数。不管是新用户的请求还是老用户的<code>I／O</code>完成，都将以事件方式加入事件环等待调度。<br>举一个通俗点的例子，你在餐厅吃饭，如果当时店内生意比较好，你坐下来，服务员过来招待你，这时，另一桌也刚坐下并呼叫服务员。正常情况下，服务员肯定会想给你个菜单让你自己看看，看好了再叫他，接着去招呼那一桌的客人了，完了再给你端茶什么的。</p>
<h3 id="Node学习之前"><a href="#Node学习之前" class="headerlink" title="Node学习之前"></a><code>Node</code>学习之前</h3><h4 id="V8引擎"><a href="#V8引擎" class="headerlink" title="V8引擎"></a>V8引擎</h4><p>编程语言分为编译型语言和解释型语言两类，编译型语言在执行之前要先进行完全编译，而解释型语言一边编译一边执行，很明显解释型语言的执行速度慢于编译型语言，而javascript就是一种解释型脚本语言，而且，鉴于它是在前端执行，需要及时响应用户，所以要求它可以快速的解析以及执行。<br>随着web相关技术的发展，javascript所要承担的工作任务也越来越多，早就超越了当初的“表单验证”的范畴，这就更需要快速的解析和执行js脚本，V8引擎就是为解决这一问题而生。v8引擎是一款专门对js语言进行解释和执行的流程虚拟机，如果把v8引擎嵌入到浏览器中，那么我们的js代码就能被浏览器所执行，这样，如果我们把v8引擎嵌入到<code>Node</code>环境中，那么我们的js代码就能被服务器所执行，所以只要将v8引擎嵌入到不同的宿主环境中都可以执行我们的js代码，这样js的应用也就越来越广泛（万能的js由来）。<br>同时v8引擎没有同步<code>I/O</code>机制，且有强大的事件驱动机制，<code>Node</code>爸比2009年正式推出了基于JavaScript语言和V8引擎的开源Web服务器项目，命名为<code>Node</code>，最大的优势是借助JavaScript天生的事件驱动机制加V8高性能引擎，使编写高性能Web服务轻而易举，可以和系统进行交互。<br>注意：<code>Node</code>不是语言，是一个平台（包装后的v8引擎），语言还是js语言。</p>
<h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><ul>
<li>所有的web资源都是放在web服务器中的</li>
<li>web服务器就是可以供外界访问web资源的一个软件</li>
<li>将web资源放到指定的目录当中，就可以通过对应的端口在浏览器中访问到<br>例如：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//一个url地址</div><div class="line">http://www.cms.com:80/index.html</div><div class="line">//其中</div><div class="line">//`http`是访问的协议</div><div class="line">//`www.cms.com`是服务器的一个唯一域名，映射到的是一个IP地址</div><div class="line">//`80`是端口号：软件的门牌号</div><div class="line">`/index.html`等这些路径中有0或多个斜杠`/`隔开的字符表示服务器上的目录或文件</div></pre></td></tr></table></figure>
</li>
</ul>
<p>一个页面的js代码，图片等这些都是要通过http请求拿到的，因此雪碧图，webpack打包js代码文件这些能减少http请求。</p>
<h4 id="http协议"><a href="#http协议" class="headerlink" title="http协议"></a>http协议</h4><p>客户端发送什么格式的数据，服务器返回什么格式的数据，需要通过http协议来约束双方的规范，即约束请求和响应的规则，只有双方协议达成一致才好通信交流。<br>http都是由请求和响应成对出现的。<br>请求的发送方式：</p>
<ul>
<li>通过浏览器地址</li>
<li>通过html中的表单（也就是接口访问）</li>
<li>通过a标签链接的<code>href</code>（点击跳转到新页面）</li>
<li>src属性<br>一般常用的http请求方式就是<code>get</code>和<code>post</code>两种：<br><code>get</code>请求会将参数显示在地址栏中，不安全，因此不能使用这种方式请求提交敏感信息；<code>get</code>方法有大小限制，最多只能提交1024个字符；<code>get</code>请求会保存在浏览器的浏览记录中；主要用来获取数据。<br><code>post</code>请求查询参数会以请求体的方式存在，不会出现在地址栏中，更安全；浏览数据不会被保存在浏览器的浏览记录中，相比<code>get</code>请求安全；可以传输的数据量大，可以达到2M；主要用来将数据传送到服务器端。</li>
</ul>
<h3 id="Node基础"><a href="#Node基础" class="headerlink" title="Node基础"></a><code>Node</code>基础</h3><p>直接从官网下对应版本的<code>Node</code>直接安装，然后打开命令行软件输入<code>node -v</code>如果可以看到版本的版本说明就安装成功了。如何运行呢？<br>1、直接进入<code>node</code>环境运行js代码。输入<code>node</code>进入<code>node</code>的环境，就可以进行编写并运行js代码了；<br>2、运行js文件，首先新建一个js文件，然后在命令行中指定到相应的文件位置，直接<code>node 文件名.js</code>即可直接运行js代码了</p>
<h4 id="模块化开发"><a href="#模块化开发" class="headerlink" title="模块化开发"></a>模块化开发</h4><p>ES6之前，js存在几个问题：<br>1、没有模块化<br>2、官方标准的标准库比较少<br>3、缺乏包管理系统<br>在开发过程中我们知道，当程序设计的规模达到了一定的程度，则必须对其进行模块化。但是，这样做就有一个前提，就是大家必须以同样的方式编写模块，否则不同人有不同的编写方式就乱套了，于是模块化规范出来了。<br>js中模块化规范有三种：<code>commonJS</code>,<code>AMD</code>,<code>CMD</code></p>
<h5 id="commonJS"><a href="#commonJS" class="headerlink" title="commonJS"></a><code>commonJS</code></h5><p> <code>commonJS</code>API定义很多普通应用程序使用的API，它的终极目标是提供一个类似Java标准库，这样的话开发者可以使用它来编写应用程序，然后这些应用可以运行在不同的js解释器和不同的主机环境中。<code>Node</code>将js语言用于服务器端编程，那就必须使用模块化开发，因为在服务器端一定要与操作系统和其他的应用程序进行互动否则无法编程,也就是说<code>Node</code>是<code>commonJS</code>规范的实现。<br><code>commonJS</code>定义的模块分为三个部分：<br>1、模块引用（<code>require</code>，用来引入外部模块）<br>2、模块定义（<code>exports</code>用于导出当前模块的方法和变量）<br>3、模块标识（<code>module</code>代表模块本身）<br>在浏览器端<code>commonJS</code>规范运行会有一个问题，就是<code>require</code>模块加载都是同步的，这对服务器端不是一个问题，因为所有的模块都是放在本地硬盘可以同步加载完成，等待时间就是硬盘的读取时间，但是对于浏览器模块都放在服务器端，等待时间取决于网速的快慢，等待时间较长时会使得浏览器处于”假死“状态，因此浏览器的模块不能采用同步加载，只能采用异步加载，这就是<code>AMD</code>规范的诞生背景。</p>
<h5 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a><code>AMD</code></h5><p><code>commonJS</code>是主要为了JS在后端(<code>Node</code>)的表现制定的，他是不适合前端的，<code>AMD</code>(异步模块定义)出现了，它就主要为前端JS的表现制定规范。<code>AMD</code>采用异步方式加载模块，模块的加载不影响后面语句的运行，所依赖模块的语句都定义在一个回调函数中等待模块加载完成后执行，加载模块的方式和<code>commonJS</code>一样都是使用<code>require</code>，但是要求两个参数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">require([module], callback)</div><div class="line">//[module]就是要加载的模块，callback就是加载成功后的回调函数</div></pre></td></tr></table></figure></p>
<p>一个简单的实例区别<code>commonJS</code>和<code>AMD</code>加载：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//commonJS加载模块</div><div class="line">var math = require(&apos;math&apos;)</div><div class="line">math.add(2, 3)</div><div class="line"></div><div class="line">//AMD加载模块</div><div class="line">require([&apos;math&apos;], function(math)&#123;</div><div class="line">    math.add(2, 3)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>所以，很明显<code>AMD</code>比较适合浏览器环境，目前主要有两个js库实现了<code>AMD</code>规范：<code>require.js</code>和<code>curl.js</code>。<br><code>require.js</code>加载的模块采用<code>AMD</code>规范，模块必须采用特定的<code>define()</code>函数来定义：<br>1、不依赖其他模块的模块定义<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//math.js</div><div class="line">define(function()&#123;</div><div class="line">    ...</div><div class="line">    return ...</div><div class="line">&#125;)</div><div class="line">//加载方法</div><div class="line">//mian.js</div><div class="line">require([&apos;math&apos;, function(math)&#123;</div><div class="line"></div><div class="line">&#125;])</div></pre></td></tr></table></figure></p>
<p>2、需要依赖其他模块的模块定义<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">define([&apos;myLib&apos;], function(myLib)&#123;</div><div class="line">    ...</div><div class="line">    return ...</div><div class="line">&#125;)</div><div class="line">//当require函数加载这个模块时会先加载myLib.js文件</div></pre></td></tr></table></figure></p>
<h5 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a><code>CMD</code></h5><p><code>CMD</code>和<code>AMD</code>最明显的区别就是在模块定义时对依赖的处理不同<br>1、<em><code>AMD</code>推崇依赖前置，在定义模块的时候就要声明其依赖的模块</em><br>2、<em><code>CMD</code>推崇就近依赖，只有在用到某个模块的时候再去require</em><br>看个例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">define(function(require, exports, module) &#123;</div><div class="line">    console.log(&apos;require module: main&apos;);</div><div class="line"></div><div class="line">    var mod1 = require(&apos;./mod1&apos;);</div><div class="line">    mod1.hello();</div><div class="line">    var mod2 = require(&apos;./mod2&apos;);</div><div class="line">    mod2.hello();</div><div class="line"></div><div class="line">    return &#123;</div><div class="line">        hello: function() &#123;</div><div class="line">            console.log(&apos;hello main&apos;);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>上面代码使用<code>SeaJS(CMD)</code>和<code>RequireJS(AMD)</code>执行的效果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//seaJS</div><div class="line">require module: main</div><div class="line">require module: mod1</div><div class="line">hello mod1</div><div class="line">require module: mod2</div><div class="line">hello mod2</div><div class="line">hello main</div><div class="line"></div><div class="line">//requireJS</div><div class="line">require module: mod1</div><div class="line">require module: mod2</div><div class="line">require module: main</div><div class="line">hello mod1</div><div class="line">hello mod2</div><div class="line">hello main</div></pre></td></tr></table></figure></p>
<h4 id="模块使用"><a href="#模块使用" class="headerlink" title="模块使用"></a>模块使用</h4><p>不管是哪种模块化方式，变量或者函数只能在当前模块中使用，如果想在别的模块中引用，必须有<code>exports</code>暴露与<code>require</code>引用。<br>而且，只有被暴露的变量或者函数才能被其他模块引用，没有暴露的依然不能被引用（也就是说<code>require</code>进来的模块其实就是代表的暴露变量的那个模块的<code>exports</code>对象，所以才是暴什么用什么）。<br>模块也分两种：文件模块和核心模块。引入的方法也所有不同：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//引入我们自己写的文件模块，即使是在同一个文件路径下也要写上./</div><div class="line">require(&apos;./o1.js&apos;)</div><div class="line"></div><div class="line">//node自带的核心模块，就不用./路径</div><div class="line">require(&apos;http&apos;)</div></pre></td></tr></table></figure></p>
<h4 id="exports和require如何而来"><a href="#exports和require如何而来" class="headerlink" title="exports和require如何而来"></a><code>exports</code>和<code>require</code>如何而来</h4><p>其实每个<code>Node</code>文件都在最外层套了一个函数，这个函数有参数<code>exports</code>，<code>require</code>，<code>module</code>…，也是因为这样，我们才能通过<code>require</code>，<code>exports</code>这些方法来暴露和引用我们的模块。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//在js文件中打印arguments，发现有值，说明这个文件其实是一个函数</div><div class="line">console.log(arguments)</div><div class="line"></div><div class="line">//通过arguments的callee方法找到这个函数本身，发现它确实是一个函数Function</div><div class="line">console.log(arguments.callee)</div><div class="line"></div><div class="line">//以字符串形式打印出这个函数</div><div class="line">console.log(arguments.callee + &apos;&apos;)</div><div class="line"></div><div class="line">//此时会发现，其实就是在我们的文件内容的外部套了一层带有参数的函数，函数里面的内容还是我们写的文件内容</div></pre></td></tr></table></figure></p>
<p><img src="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180619_1.png" alt=""><br>也就是说虽然看起来我们只写了里面的内容，但是事实上它是有匿名函数包含的一个函数。可以通过在函数中打印<code>console.log(module)</code>和<code>console.log(exports)</code>证实<br>另外，<code>exports</code>和<code>module.exports</code>也有所区别<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">console.log(exports===module.exports)//true</div></pre></td></tr></table></figure></p>
<p>从代码可以验证这俩是一样的，但是还是有区别的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//01.js</span></div><div class="line">exports.str = <span class="string">'str'</span></div><div class="line">exports.fn = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'fn'</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//02.js</span></div><div class="line"><span class="keyword">let</span> rs = <span class="built_in">require</span>(<span class="string">'./01.js'</span>)</div><div class="line"><span class="built_in">console</span>.log(rs) <span class="comment">// &#123;str: 'str', fn: [Function]&#125;</span></div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//01.js</span></div><div class="line">exports = &#123;</div><div class="line">    <span class="attr">str</span>: <span class="string">'str'</span>,</div><div class="line">    <span class="attr">fn</span>: <span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'fn'</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//02.js</span></div><div class="line"><span class="keyword">let</span> rs = <span class="built_in">require</span>(<span class="string">'./01.js'</span>)</div><div class="line"><span class="built_in">console</span>.log(rs) <span class="comment">// &#123;&#125;</span></div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//01.js</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">str</span>: <span class="string">'str'</span>,</div><div class="line">    <span class="attr">fn</span>: <span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'fn'</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//02.js</span></div><div class="line"><span class="keyword">let</span> rs = <span class="built_in">require</span>(<span class="string">'./01.js'</span>)</div><div class="line"><span class="built_in">console</span>.log(rs) <span class="comment">// &#123;str: 'str', fn: [Function]&#125;</span></div></pre></td></tr></table></figure>
<p>原理可以理解为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">let module = new Object()</div><div class="line">module.exports = new Object(&#123;name: &apos;name1&apos;&#125;)</div><div class="line">let exports = module.exports</div><div class="line">exports.name = &apos;kkk&apos;</div><div class="line">module.exports.name = &apos;kkk&apos;</div><div class="line">//所以exports通过点语法暴露和module.exports暴露时没有差别</div><div class="line">//如果exports暴露一个对象</div><div class="line">exports = &#123;name: &apos;kkk&apos;&#125;</div><div class="line">//这样其实就是等于将module和exports.module之间的联系切断了，内存地址直接发生了变化</div></pre></td></tr></table></figure>
<p>因此，<code>module.exports</code>包含了<code>exports</code>全部的功能，<code>exports</code>不能暴露一个对象，只能使用点语法。</p>
<h3 id="Node文件读写"><a href="#Node文件读写" class="headerlink" title="Node文件读写"></a><code>Node</code>文件读写</h3><h4 id="Buffer缓冲器"><a href="#Buffer缓冲器" class="headerlink" title="Buffer缓冲器"></a><code>Buffer</code>缓冲器</h4><p>js本身只能处理字符串数据类型，没有二进制数据类型，作为前端工程师我们也只是处理一些简单的字符串和<code>DOM</code>，不能处理二进制数据。</p>
<p>但在处理像<code>TCP</code>流或文件流时，必须使用到二进制数据。因此在 <code>Node</code>中，定义了一个 <code>Buffer</code> 类，该类用来创建一个专门存放二进制数据的缓存区，让 <code>Node</code> 处理二进制数据（实在太饿了，没忍住准备吃包方便面。。。）</p>
<h4 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h4><h5 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h5><p><code>Node</code>用来服务器端就是要对文件进行交互，比如本地文件发送到客户端等。<code>Node</code>就通过<code>fs</code>模块（<code>let fs = require(&#39;fs&#39;)</code>）来和文件系统进行交互，该模块提供标准的API对文件进行读写等操作（这里就说到上面的<code>Buffer</code>了，<code>fs</code>模块读取文件内容返回的就是一个<code>Buffer</code>）</p>
<p>介绍这么多，用一下就会觉得很神奇：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"></div><div class="line"><span class="comment">//Sync表示的都是同步的，会造成线程阻塞，可以使用相应的异步操作，这里只是test</span></div><div class="line"><span class="comment">//打开02.js，对它进行写write操作</span></div><div class="line"><span class="comment">//如果当前文件夹下没有02.js文件，就会自动创建一个</span></div><div class="line"><span class="comment">//如果已经有了这个02.js文件，执行同步打开这个操作会删除02.js里面的内容</span></div><div class="line"><span class="keyword">let</span> file = fs.openSync(<span class="string">'02.js'</span>, <span class="string">'w'</span>)</div><div class="line"></div><div class="line"><span class="comment">//写入内容</span></div><div class="line">fs.writeFileSync(file, <span class="string">'我被写入内容啦！'</span>)</div><div class="line"></div><div class="line"><span class="comment">//保存并退出</span></div><div class="line">fs.closeSync(file)</div></pre></td></tr></table></figure>
<p>此时，控制台运行一下该文件–<code>node 01.js</code>，<code>02.js</code>文件中就会有<code>我被写入内容啦！</code>这句话，是不是很神奇。<code>Node</code>更多的API可以参考<a href="http://nodejs.cn/api/" target="_blank" rel="external">中文文档</a>。为了再看一遍这个神奇的操作，下面再做一个异步的操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"></div><div class="line"><span class="comment">//异步操作</span></div><div class="line"><span class="comment">//打开文件</span></div><div class="line">fs.open(<span class="string">'02.js'</span>,<span class="string">'w'</span>, (err, file)=&gt;&#123;</div><div class="line">    <span class="keyword">if</span>(!err)&#123;</div><div class="line">        <span class="comment">//写入内容</span></div><div class="line">        fs.writeFile(file, <span class="string">'我又被写入内容啦哈哈哈哈'</span>, (err)=&gt;&#123;</div><div class="line">            <span class="keyword">if</span>(!err)&#123;</div><div class="line">                <span class="comment">//写入成功</span></div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'写入成功'</span>)</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'写入失败'</span>)</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//保存关闭文件</span></div><div class="line">            fs.close(file, (err)=&gt;&#123;</div><div class="line">                <span class="keyword">if</span>(!err)&#123;</div><div class="line">                    <span class="built_in">console</span>.log(<span class="string">'文件保存并关闭成功'</span>)</div><div class="line">                &#125;</div><div class="line">            &#125;)</div><div class="line">        &#125;)</div><div class="line">    &#125;<span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'打开文件失败'</span>)</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>此时打开<code>02.js</code>文件看到<code>我又被写入内容啦哈哈哈哈</code>。</p>
<p>异步操作看到了，很多的嵌套回调函数。异步的好处就是即使这里在回调函数<code>fs.open</code>中发生了错误（不管是哪一层），<code>fs.open</code>后面的代码依然可以运行，它只是内部出错了不影响外面代码的执行。</p>
<p>还有一种写入内容的方式：文件流式写入<code>writeStream</code>。相当于在文件和<code>Node</code>服务器之间建立通道，通道打开后可以一直写入内容，写入结束就关闭通道。</p>
<h5 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h5><p>这里我们就不写同步的了，因为推荐都是使用异步方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"></div><div class="line">fs.readFile(<span class="string">'02.js'</span>, (err, data)=&gt;&#123;</div><div class="line">    <span class="keyword">if</span>(!err)&#123;</div><div class="line">        <span class="comment">//读取的文件都是Buffer二进制流</span></div><div class="line">        <span class="built_in">console</span>.log(data)</div><div class="line">        <span class="comment">//&lt;Buffer e6 88 91 e5 8f 88 e8 a2 ab e5 86 99 e5 85 a5 e5 86 85 e5 ae b9 e5 95 a6 e5 93 88 e5 93 88 e5 93 88 e5 93 88&gt;</span></div><div class="line">        <span class="comment">//可以通过转换看看是不是我们02.js文件中的内容</span></div><div class="line">        <span class="built_in">console</span>.log(data.toString())</div><div class="line">        <span class="comment">//我又被写入内容啦哈哈哈哈</span></div><div class="line">    &#125;<span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>这里只是读取了一个js文件，可以自行尝试读取一张图片等其他文件。读取文件同样存在一个流式读入方法<code>readStream</code>和<code>pipe</code>方法，通过通道将一个大文件切割成很多个小文件不断上传最后整合完成。</p>
<p>注意：针对图片，音频和视频这种文件格式，如果想看是否正确的读取了，不能简单的通过<code>data.toString()</code>方法，这样只能得到乱码，我们可以通过写入的方式新创建一个文件就能还原这个读取的文件了。</p>
<h3 id="Node数据库"><a href="#Node数据库" class="headerlink" title="Node数据库"></a><code>Node</code>数据库</h3><p>前端开发很少能用到数据库，但是又不能不了解这些，So。。。</p>
<p>这里选用的数据库是<code>MongoDB</code>，因为听说它和<code>Node</code>配一脸。</p>
<p>一般我们常听到的那些什么<code>mySQL</code>、<code>SQL Server</code>、<code>Oracle</code>这些都是关系型数据库，通过一张张表来建立联系；非关系型数据库就没有行和列的概念，而是用<code>JSON</code>来存储数据的，比如<code>MongoDB</code>、<code>Redis</code>等。</p>
<h4 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a><code>MongoDB</code></h4><p>是的，它就是和我们的<code>Node</code>配一脸的非关系型数据库。</p>
<h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><p>直接命令安装，因为官网不能直接下载，需要注册账号等乱七八糟的，所以这里找到了一个直接命令行安装的操作：</p>
<p>1、下载<code>curl -O https://fastdl.mongodb.org/osx/mongodb-osx-x86_64-3.2.1.tgz</code></p>
<p>2、解压<code>tar -zxvf mongodb-osx-x86_64-3.2.1.tgz</code></p>
<p>3、复制解压之后的文件夹并新建一个文件夹<code>mkdir -p mongodb</code>，<code>cp -R -n mongodb-osx-x86_64-3.2.1/ mongodb</code></p>
<p>4、环境变量配置：可以将解压后的文件夹直接放到<code>usr/local</code>目录中，然后在环境变量文件<code>_bash.profile</code>中添加<code>mongodb</code>的环境变量，最后<code>source /Users/Yyuan/.bash_profile</code>让刚才修改的环境变量生效。</p>
<p>5、此时<code>echo $PATH</code>可以看到刚才修改的环境变量了</p>
<p>6、此时<code>mongo</code>可以看到版本号啦。</p>
<h5 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h5><p>1、首先找到地方新建一个文件夹<code>data</code>，并在里面新建一个文件夹<code>db</code></p>
<p>2、命令行中输入<code>mongod</code>，可以看到结果信息，其中端口号是27017</p>
<p>3、可以看到默认路径是<code>/data/db</code>，打开终端直接输入命令<code>sudo mkdir -p /data/db</code>，到此就创建了符合默认路径的文件夹。如果想修改默认<code>data/db</code>的路径：<code>mongod --dbpath /Users/Yyuan/database/mongodb/data/db</code>。专家推荐，还是使用默认的路径比较好。</p>
<p>4、终端输入<code>mongod</code>发现报错</p>
<p><img src="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180702_13.png" alt=""></p>
<p>说明没有读写权限，加权限<code>sudo chown Yyuan /data/db</code></p>
<p>5、如果遇到下面的错误</p>
<p><img src="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180702_14.png" alt=""></p>
<p>说明没有找到用来存放数据的那个文件夹：打开终端，返回到根目录下然后<code>sudo mkdir -p /data/db</code>新建默认路径文件夹</p>
<p>6、此时再输入<code>mongod</code>，并在浏览器中打开<a href="http://localhost:27017/" target="_blank" rel="external">页面</a>会看到下面一段话</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">It looks like you are trying to access MongoDB over HTTP on the native driver port.</div></pre></td></tr></table></figure>
<p>7、<code>mongod</code>是用来启动服务端的，另开一个窗口输入命令<code>mongo</code>打开命令行的客户端就可以来对数据库进行操作了，例如查看当前所有的数据库<code>show dbs</code>等等。。。</p>
<h5 id="小试牛刀"><a href="#小试牛刀" class="headerlink" title="小试牛刀"></a>小试牛刀</h5><p>1、首先清个屏：<code>cls</code>哈哈</p>
<p>2、然后我们来查看下当前的所有数据库：<code>show dbs</code></p>
<p>3、创建一个<code>school</code>数据库：<code>use school</code>（有就进入没有就创建了再进入）</p>
<p>4、不信，你可以看看你当前所在的位置<code>db</code>（这里就是<code>school</code>）</p>
<p>5、现在再来看看我们这个数据库中所有集合：<code>show collections</code>（刚创建的数据库当然啥也没有喽）</p>
<p>6、增：向<code>school</code>数据库中的学生集合<code>student</code>中插入一个学生，学生信息为<code>{id: &#39;001&#39;, name: &#39;Jack&#39;, age: 18, sex: &#39;男&#39;}</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; db.student.insert(&#123;id: &quot;001&quot;, name: &quot;Jack&quot;, age: &quot;18&quot;, sex: &quot;男&quot;&#125;)</div><div class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;) //插入成功</div></pre></td></tr></table></figure>
<p>7、查：查看当前<code>student</code>集合中所有数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; db.student.find()</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b3b8fb05dc9003f0524034d&quot;), &quot;id&quot; : &quot;001&quot;, &quot;name&quot; : &quot;Jack&quot;, &quot;age&quot; : &quot;18&quot;, &quot;sex&quot; : &quot;男&quot; &#125;	//查询结果</div></pre></td></tr></table></figure>
<h5 id="mongodb可视化工具"><a href="#mongodb可视化工具" class="headerlink" title="mongodb可视化工具"></a><code>mongodb</code>可视化工具</h5><p>上面那种命令行操作已经看到效果了，但是效率实在太低，所以这里使用一个可视化工具—-<code>RoboMongo</code>（傻瓜式安装，所以就不废话了），安装成功后<code>create</code>并<code>connect</code>后：</p>
<p><img src="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180703_16.png" alt=""></p>
<p>能看到我们刚才插入的信息了，在这里可以直接输入命令或者直接进行数据库的增删改查操作，具体的命令参考<a href="http://www.mongodb.org.cn/manual/" target="_blank" rel="external">mongodb中文手册</a>进行查看。</p>
<h5 id="mongoose基本操作"><a href="#mongoose基本操作" class="headerlink" title="mongoose基本操作"></a><code>mongoose</code>基本操作</h5><p>上面都是使用命令行或者可视化工具对数据库进行操作，这里使用<code>node</code>来对<code>mongodb</code>进行操作。</p>
<p>1、首先新建一个项目，并安装<code>mongoose</code>：<code>npm init</code>，<code>npm i mongoose</code></p>
<p>2、项目中新建一个js文件，先对数据库进行连接：<a href="https://mongoose.shujuwajue.com/guide/schemas.html" target="_blank" rel="external">参考mongoose的API</a></p>
<p><img src="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180708_18.png" alt=""></p>
<p>see！数据库连接成功啦！！！</p>
<p>3、创建<code>Schema</code>（模式对象）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//4、创建Schema模式对象</span></div><div class="line"><span class="keyword">let</span> Schema = mongoose.Schema</div><div class="line"><span class="keyword">let</span> personSchema = <span class="keyword">new</span> Schema(&#123;</div><div class="line">    <span class="attr">name</span>: <span class="built_in">String</span>,</div><div class="line">    <span class="attr">age</span>: <span class="built_in">Number</span>,</div><div class="line">    <span class="attr">sex</span>: &#123;</div><div class="line">        <span class="attr">type</span>: <span class="built_in">String</span>,</div><div class="line">        <span class="attr">default</span>: <span class="string">'男'</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">chat</span>: <span class="built_in">String</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>相当于创建了一个文档的规则，字段名和值类型等等</p>
<p>4、创建<code>Model</code>对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//5、创建Model对象</span></div><div class="line"><span class="keyword">let</span> personModel = mongoose.model(<span class="string">'people'</span>, personSchema)</div></pre></td></tr></table></figure>
<p>相当于创建一个集合，集合符合之前创建的规则</p>
<p>5、插入文档</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//6、插入文档</span></div><div class="line">personModel.create(&#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'袁媛'</span>,</div><div class="line">    <span class="attr">age</span>: <span class="number">27</span>,</div><div class="line">    <span class="attr">sex</span>: <span class="string">'女'</span>,</div><div class="line">    <span class="attr">chat</span>: <span class="string">'yuanyuan.com'</span></div><div class="line">&#125;, (err)=&gt;&#123;</div><div class="line">    <span class="keyword">if</span>(!err)&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'插入成功'</span>)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">throw</span> err</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line">personModel.create(&#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'任佳鑫'</span>,</div><div class="line">    <span class="attr">age</span>: <span class="number">27</span>,</div><div class="line">    <span class="attr">chat</span>: <span class="string">'renjiaxin.com'</span></div><div class="line">&#125;, (err)=&gt;&#123;</div><div class="line">    <span class="keyword">if</span>(!err)&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'插入成功'</span>)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">throw</span> err</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>这里插入了两条记录，一个男一个女，可以看到默认字段可以不传</p>
<p>6、<code>node 01.js</code>此时运行代码控制台打印插入成功，进入到可视化工具中看到<code>m_data</code>中已经有了一个名叫<code>peoples</code>的集合，其中有了两条记录。这样就实现了使用<code>node</code>来对<code>mongodb</code>进行操作。</p>
<h3 id="Node常用模块之URL模块"><a href="#Node常用模块之URL模块" class="headerlink" title="Node常用模块之URL模块"></a><code>Node</code>常用模块之<code>URL</code>模块</h3><p>URL竟然也是一个模块？这个模块我们平时有用到么？我怎么不记得了。。。</p>
<p>当然有，开发过程中，我们需要把一个URL地址中的某个部分获取到的时候就用到了，URL模块提供很多<a href="http://nodejs.cn/api/url.html" target="_blank" rel="external">API</a>可以直接帮助我们获取我们想要的东西，处理我们想要的结果等等。</p>
<h3 id="Node常用模块之HTTP模块"><a href="#Node常用模块之HTTP模块" class="headerlink" title="Node常用模块之HTTP模块"></a><code>Node</code>常用模块之<code>HTTP</code>模块</h3><h4 id="创建http服务"><a href="#创建http服务" class="headerlink" title="创建http服务"></a>创建<code>http</code>服务</h4><p>首先我们创建一个<code>http</code>服务器，并给客户端返回数据：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//1、引入http模块</span></div><div class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</div><div class="line"></div><div class="line"><span class="comment">//2、创建服务器</span></div><div class="line"><span class="keyword">let</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>)=&gt;</span>&#123;</div><div class="line">    <span class="comment">//req服务器请求，res服务器响应</span></div><div class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html;charset=UTF-8'</span>&#125;)</div><div class="line">    res.end(<span class="string">'hello'</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//3、监听服务器是否被访问</span></div><div class="line">server.listen(<span class="number">80</span>, <span class="string">'127.0.0.1'</span>)</div></pre></td></tr></table></figure>
<p>命令行<code>node 02.js</code>运行下，发现报错了：</p>
<p><img src="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180709_19.png" alt=""></p>
<p>原因是因为端口号被占用了，将<code>80</code>端口换成<code>8088</code>：<code>server.listen(8088, &#39;127.0.0.1&#39;)</code>重新运行后成功了，浏览器中打开<a href="127.0.0.1:8088" target="_blank" rel="external">127.0.0.1:8088</a>此时就能看到打印出来的<code>hello</code>了。</p>
<p>这里<code>Content-Type</code>值是<code>html</code>，所以如果在<code>res.end</code>之前加上这句<code>res.write(&#39;&lt;h1&gt;哈咯&lt;/h1&gt;&#39;)</code>，会发现浏览器中打印出了<code>h1</code>格式的文字，因此这里<code>Content-Type</code>还是比较重要的，反应了服务器响应的数据格式。</p>
<p>如果想看请求的数据，可以直接在打印<code>console.log(req)</code>来查看，例如在浏览器中输入<code>127.0.0.1/kkk</code>此时会看到打印出来的<code>req.url</code>是<code>/kkk</code>，前面的会被直接省略的。</p>
<h4 id="Node中的路由"><a href="#Node中的路由" class="headerlink" title="Node中的路由"></a><code>Node</code>中的路由</h4><p>像上面那种创建了一个服务器以后，不管浏览器地址怎么输入，虽然请求的<code>url</code>所有不同，但是显示的都是一样的值，因为服务器给出的响应值都是一样的。那怎么实现根据请求的<code>url</code>的不同来显示不同的文件，从而浏览器显示不同的内容呢？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//1、引入http模块</span></div><div class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</div><div class="line"><span class="comment">//引入fs模块读取文件</span></div><div class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"></div><div class="line"><span class="comment">//2、创建服务器</span></div><div class="line"><span class="keyword">let</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>)=&gt;</span>&#123;</div><div class="line">    <span class="comment">//req服务器请求，res服务器响应</span></div><div class="line">    <span class="keyword">if</span>(req.url === <span class="string">'/page1.html'</span>)&#123;</div><div class="line">        <span class="comment">//根据路由显示page1.html页面</span></div><div class="line">        fs.readFile(<span class="string">'./page1.html'</span>, (err, data)=&gt;&#123;</div><div class="line">            <span class="keyword">if</span>(!err)&#123;</div><div class="line">                res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html;charset=UTF-8'</span>&#125;)</div><div class="line">                res.end(data)</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(req.url === <span class="string">'/page2.html'</span>)&#123;</div><div class="line">        <span class="comment">//根据路由显示page2.html页面</span></div><div class="line">        fs.readFile(<span class="string">'./page2.html'</span>, (err, data)=&gt;&#123;</div><div class="line">            <span class="keyword">if</span>(!err)&#123;</div><div class="line">                res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html;charset=UTF-8'</span>&#125;)</div><div class="line">                res.end(data)</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(req.url === <span class="string">'/'</span>)&#123;</div><div class="line">        res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html;charset=UTF-8'</span>&#125;)</div><div class="line">        res.end(<span class="string">'我是根目录127.0.0.1'</span>)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        res.writeHead(<span class="number">404</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html;charset=UTF-8'</span>&#125;)</div><div class="line">        res.end(<span class="string">'访问的页面不存在'</span>)</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//3、监听服务器是否被访问</span></div><div class="line">server.listen(<span class="number">8088</span>, <span class="string">'127.0.0.1'</span>)</div></pre></td></tr></table></figure>
<p>此时，可以在浏览器中访问看看输入不同的地址返回的是什么内容。</p>
<p><code>Node</code>中没有web容器，不是根据文件在文件夹中的路径来返回页面的，都是根据路由指定来返回内容的，只是在开发中我们都会将路由和文件路径对应上而已。</p>
<p>再来看一个例子：假如我们给<code>page1.html</code>加一个外联样式</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">//page1.html</div><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/index.css"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>HTTP!!!!!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>重启一下服务器，打开<code>127.0.0.1/page1.html</code>发现css中的样式并没有作用，这就是因为在<code>Node</code>中没有web容器的意思，根据文件路径来找文件是不行的。因为加载<code>css/index.css</code>文件也是要发送请求的，因此还是需要<code>Node</code>来加载这个文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//1、引入http模块</span></div><div class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</div><div class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"></div><div class="line"><span class="comment">//2、创建服务器</span></div><div class="line"><span class="keyword">let</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>)=&gt;</span>&#123;</div><div class="line">    <span class="comment">//req服务器请求，res服务器响应</span></div><div class="line">    <span class="keyword">if</span>(req.url === <span class="string">'/page1.html'</span>)&#123;</div><div class="line">        ......</div><div class="line">        res.end(<span class="string">'我是根目录127.0.0.1'</span>)</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(req.url === <span class="string">'/css/index.css'</span>)&#123;</div><div class="line">        fs.readFile(<span class="string">'./css/index.css'</span>, (err, data)=&gt;&#123;</div><div class="line">            <span class="keyword">if</span>(!err)&#123;</div><div class="line">                res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/css'</span>&#125;)</div><div class="line">                res.end(data)</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        res.writeHead(<span class="number">404</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html;charset=UTF-8'</span>&#125;)</div><div class="line">        res.end(<span class="string">'访问的页面不存在'</span>)</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//3、监听服务器是否被访问</span></div><div class="line">server.listen(<span class="number">8088</span>, <span class="string">'127.0.0.1'</span>)</div></pre></td></tr></table></figure>
<p>此时再访问<code>127.0.0.1/page1.html</code>就能看到已经应用了样式表的页面，图片，视频，js文件等资源都是如此。</p>
<p>发现问题了吧？如果文件资源很多的时候直接写这个加载就直接写死了。。。这个，后面再说。</p>
<h4 id="http发送请求"><a href="#http发送请求" class="headerlink" title="http发送请求"></a><code>http</code>发送请求</h4><h5 id="http表单提交"><a href="#http表单提交" class="headerlink" title="http表单提交"></a><code>http</code>表单提交</h5><p>太久没写原生表单了：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>表单提交<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1:8088"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"age"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">value</span>=<span class="string">"男"</span>&gt;</span>男</div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">value</span>=<span class="string">"女"</span>&gt;</span>女</div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"photo"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>页面显示如下：</p>
<p><img src="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180711_23.png" alt=""></p>
<p>此时表单中写入内容后点击提交按钮就会发送请求就会跳转到服务器地址<code>http://127.0.0.1:8088/?name=yuanyuan&amp;age=12&amp;sex=%E5%A5%B3&amp;photo=jay1.png</code>通过get请求将内容发送出去，此时服务器就能拿到发送过来的内容。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</div><div class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"><span class="keyword">let</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</div><div class="line"></div><div class="line">http.createServer(<span class="function">(<span class="params">req, res</span>)=&gt;</span>&#123;</div><div class="line">    <span class="keyword">if</span>(req.url === <span class="string">'/page2.html'</span>)&#123;</div><div class="line">        <span class="comment">//根据路由显示page2.html页面</span></div><div class="line">        fs.readFile(<span class="string">'./page2.html'</span>, (err, data)=&gt;&#123;</div><div class="line">            <span class="keyword">if</span>(!err)&#123;</div><div class="line">                res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html;charset=UTF-8'</span>&#125;)</div><div class="line">                res.end(data)</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">//点击表单跳转地址</span></div><div class="line">        <span class="keyword">let</span> myUrl = url.parse(req.url, <span class="literal">true</span>)</div><div class="line">        <span class="keyword">let</span> queryObj = myUrl.query</div><div class="line">        <span class="built_in">console</span>.log(queryObj)   <span class="comment">//&#123; name: 'yuanyuan', age: '12', sex: '女', photo: 'jay1.png' &#125;</span></div><div class="line">        res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html;charset=UTF-8'</span>&#125;)</div><div class="line">        res.end(<span class="string">'提交ok'</span>)</div><div class="line">    &#125;</div><div class="line">&#125;).listen(<span class="number">8088</span>, <span class="string">'127.0.0.1'</span>)</div></pre></td></tr></table></figure>
<p>这里拿到<code>queryObj</code>就是提交过来的内容，就可以对其进行下一步操作了。</p>
<h5 id="表单上传图片处理"><a href="#表单上传图片处理" class="headerlink" title="表单上传图片处理"></a>表单上传图片处理</h5><p>上面表单上传了一张图片，服务器获取到的只是这个图片的名称，对于图片、视频音频等这些非普通类型的内容，就需要对这些内容进行一些处理了。通常我们会使用<code>fs</code>模块进行处理，但是在真实的开发环境中不会使用这种原生的方法，而是借助一些第三方的插件来实现，这里使用<code>formidable</code>（安装：<code>npm i -S formidable</code>）。</p>
<p>使用post请求来提交图片，因为一般提交内容到服务器都是使用的post方式，表单需要作一点修改：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>表单提交<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1:8088/postmsg"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></div><div class="line">        ......</div><div class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>同样我们的服务也要修改一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</div><div class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"><span class="keyword">let</span> formidable = <span class="built_in">require</span>(<span class="string">'formidable'</span>)</div><div class="line"><span class="keyword">let</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>)</div><div class="line"></div><div class="line">http.createServer(<span class="function">(<span class="params">req, res</span>)=&gt;</span>&#123;</div><div class="line">    <span class="keyword">if</span>(req.url === <span class="string">'/page2.html'</span>)&#123;</div><div class="line">        <span class="comment">//根据路由显示page2.html页面</span></div><div class="line">        fs.readFile(<span class="string">'./page2.html'</span>, (err, data)=&gt;&#123;</div><div class="line">            <span class="keyword">if</span>(!err)&#123;</div><div class="line">                res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html;charset=UTF-8'</span>&#125;)</div><div class="line">                res.end(data)</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">//点击表单跳转地址</span></div><div class="line">        <span class="keyword">if</span>(req.url === <span class="string">'/postmsg'</span> &amp;&amp; req.method.toLowerCase() === <span class="string">'post'</span>)&#123;</div><div class="line">            <span class="comment">//1、实例化对象</span></div><div class="line">            <span class="keyword">let</span> form = <span class="keyword">new</span> formidable.IncomingForm()</div><div class="line">            <span class="comment">//2、设置上传的文件路径</span></div><div class="line">            form.uploadDir = <span class="string">'./uploads'</span></div><div class="line">            <span class="comment">//3、保存扩展名</span></div><div class="line">            form.keepExtensions = <span class="literal">true</span>;</div><div class="line">            <span class="comment">//4、获取表单内容</span></div><div class="line">            form.parse(req, (err, fields, files)=&gt;&#123;</div><div class="line">                res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain;charset=UTF-8'</span>&#125;)</div><div class="line">                res.write(<span class="string">'received upload'</span>)</div><div class="line">                res.end(util.inspect(&#123;<span class="attr">fields</span>: fields, <span class="attr">files</span>: files&#125;))</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;).listen(<span class="number">8088</span>, <span class="string">'127.0.0.1'</span>)</div></pre></td></tr></table></figure>
<p>此时本地上传的图片就可以保存到<code>uploads</code>这个文件夹中了。</p>
<p>注意：如果你发现你点击提交后打印出来的<code>files</code>对象是一个空对象，这说明没有需要上传的内容，此时上传文件路径<code>uploads</code>也是空的，此时在<code>form</code>表单中加上<code>enctype=&quot;multipart/form-data&quot;</code>，表单中<code>enctype=&quot;multipart/form-data&quot;</code>的意思是设置表单的<a href="https://www.baidu.com/s?wd=MIME&amp;tn=SE_PcZhidaonwhc_ngpagmjz&amp;rsv_dl=gh_pc_zhidao" target="_blank" rel="external">MIME</a>编码。默认情况，这个编码格式是<code>application/x-www-form-urlencoded</code>，不能用于文件上传；只有使用了<code>multipart/form-data</code>，才能完整的传递文件数据，进行下面的操作。</p>
<h3 id="Epress框架"><a href="#Epress框架" class="headerlink" title="Epress框架"></a><code>Epress</code>框架</h3><p>是目前最流行的<code>Node</code>后端框架之一，<code>Express</code>和<code>Node</code>的关系相当于<code>jQuery</code>和<code>js</code>之间的关系，但是它没有对<code>Node</code>进行二次抽象，只是在其之上扩展了对web应用所需的基本功能。类似的框架还有<code>Koa.js</code>、<code>egg.js</code>，<code>hapi.js</code>。</p>
<h4 id="安装Express"><a href="#安装Express" class="headerlink" title="安装Express"></a>安装<code>Express</code></h4><p>我们初始化一个项目<code>npm init</code>，并在项目中安装<code>npm i express --save</code>。</p>
<p>和学习<code>vue</code>一样，我们首先从引入<code>express</code>这个模块学习开始，到做项目的时候我们再用它的脚手架</p>
<h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><h5 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//01.js</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"></div><div class="line"><span class="comment">//1、创建express实例</span></div><div class="line"><span class="keyword">let</span> app = express()</div><div class="line"></div><div class="line"><span class="comment">//2、路由</span></div><div class="line">app.get(<span class="string">'/'</span>, (req, res)=&gt;&#123;</div><div class="line">    res.send(<span class="string">'hello world'</span>)</div><div class="line">&#125;)</div><div class="line">app.get(<span class="string">'/html5'</span>, (req, res)=&gt;&#123;</div><div class="line">    res.send(<span class="string">'hello html5'</span>)</div><div class="line">&#125;)</div><div class="line">app.listen(<span class="number">3000</span>)</div></pre></td></tr></table></figure>
<p>中断运行<code>node 01.js</code>，此时浏览器中打开根目录<a href="127.0.0.1:3000" target="_blank" rel="external">127.0.0.1:3000</a>就能看到<code>hello world</code>，<a href="127.0.0.1:3000/html5" target="_blank" rel="external">127.0.0.1:3000/html5</a>看到<code>hello html5</code>了（还记得上面使用<code>http</code>模块创建服务器么，是不是很类似，只不过这里更加简介方便了）。</p>
<p>这里路由写的是什么浏览器中输入相应的地址就能返回回调函数中想要返回的内容。</p>
<h5 id="托管静态文件"><a href="#托管静态文件" class="headerlink" title="托管静态文件"></a>托管静态文件</h5><p>当我们使用原生的<code>Node</code>来访问静态文件时，我们需要拿到访问的路由，通过对路由的分割处理拿到我们想要访问的文件名以及文件的后缀名，然后通过<code>fs</code>模块去所在当前文件夹中拿到想要访问的文件再显示在浏览器中（反正就是很麻烦。。。）。我们来看看使用<code>express</code>是多么简单明了的：</p>
<p>当前文件夹中存在一个名为<code>public</code>的文件夹，其中有一个<code>index.html</code>文件和名为<code>css</code>的文件夹且其中有一个文件<code>index.css</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">let</span> app = express()</div><div class="line"></div><div class="line">app.use(express.static(<span class="string">'./public'</span>))</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, (req, res)=&gt;&#123;</div><div class="line">    res.send(<span class="string">'hello world'</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>)</div></pre></td></tr></table></figure>
<p>此时访问<a href="127.0.0.1:3000" target="_blank" rel="external">127.0.0.1:3000</a>这个根目录就会默认去访问<code>public</code>文件夹，由于访问文件夹时是默认寻找其中的<code>index.html</code>文件，所以也就是默认访问了<code>public</code>文件中的<code>index.html</code>文件；访问<a href="127.0.0.1:3000/css/index.css" target="_blank" rel="external">127.0.0.1:3000/css/index.css</a>返回的是<code>index.css</code>文件的内容（是不是超级方便）。</p>
<p>如果不想根目录就访问静态资源的话</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app.use(<span class="string">'/source'</span>,express.static(<span class="string">'./public'</span>))</div></pre></td></tr></table></figure>
<p>这样一来，访问根目录还是返回<code>hello world</code>，<a href="127.0.0.1:3000/source" target="_blank" rel="external">127.0.0.1:3000/source</a>才是访问静态资源的目录。具体可以查阅<a href="http://www.expressjs.com.cn/4x/api.html" target="_blank" rel="external">express的API</a>。</p>
<p><em>注意：访问文件夹时默认寻找指定文件夹中的<code>index.html</code>文件。</em></p>
<h5 id="模版引擎"><a href="#模版引擎" class="headerlink" title="模版引擎"></a>模版引擎</h5><p>1、首先安装模版<code>npm i ejs --save</code></p>
<p>2、服务代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//01.js</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">let</span> app = express()</div><div class="line"></div><div class="line"><span class="comment">//指定视图所在的位置</span></div><div class="line">app.set(<span class="string">'views'</span>, <span class="string">'./views'</span>)</div><div class="line"><span class="comment">//注册模版引擎</span></div><div class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'ejs'</span>)</div><div class="line"></div><div class="line"><span class="comment">//使用模版引擎</span></div><div class="line">app.get(<span class="string">'/'</span>, (req, res)=&gt;&#123;</div><div class="line">    res.render(<span class="string">'index'</span>, &#123;<span class="string">'lists'</span>: [<span class="string">'章三'</span>, <span class="number">18</span>, <span class="string">'篮球'</span>]&#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>)</div></pre></td></tr></table></figure>
<p>3、创建一个<code>views</code>的文件夹和<code>01.js</code>平级，里面创建一个<code>index.ejs</code>，内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">//index.ejs</div><div class="line"></div><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</div><div class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</div><div class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</div><div class="line">    &lt;title&gt;&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">    &lt;ul&gt;</div><div class="line">        &lt;%</div><div class="line">            for(var i =0; i&lt;lists.length; i++)&#123;</div><div class="line">        %&gt;</div><div class="line">        &lt;li&gt;&lt;%= lists[i] %&gt;&lt;/li&gt;</div><div class="line">        &lt;%</div><div class="line">            &#125;</div><div class="line">        %&gt;</div><div class="line">    &lt;/ul&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>4、浏览器中输入地址<a href="127.0.0.1:3000" target="_blank" rel="external">127.0.0.1:3000</a>可以看到传入的<code>lists</code>以<code>li</code>的形式显示，表示页面中接收到了传入的参数并将其渲染。</p>
<h4 id="应用生成器"><a href="#应用生成器" class="headerlink" title="应用生成器"></a>应用生成器</h4><p>在开发<code>vue</code>项目时，我们使用<code>vue-cli</code>来生成项目的一个整体架构，<code>express</code>也有这样一个应用生成器（一般我称作脚手架），可以快速的生成一个项目的骨架。</p>
<h5 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h5><p>以管理员身份全局安装：<code>sudo npm i express-generator -g</code></p>
<p>全局安装好以后就可以使用其来生成一个项目了</p>
<p><em>注意：全局安装必须使用管理员身份，否则会报错</em></p>
<h5 id="初始化工程"><a href="#初始化工程" class="headerlink" title="初始化工程"></a>初始化工程</h5><p>1、上面已经全局安装了<code>express</code>的脚手架，找到一个你想要放置项目的目录，然后设置模版引擎（视图引擎）为<code>ejs</code>，项目名称为<code>expressProject</code>，命令行语句为：<code>express --view=ejs expressProject</code></p>
<p>生成项目骨架如下</p>
<p><img src="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180719_1.png" alt=""></p>
<p>2、根据提示，进入项目中：<code>cd expressProject</code></p>
<p>3、安装项目依赖：<code>npm install</code></p>
<p>4、运行项目：<code>DEBUG=expressprject:* npm start</code></p>
<p>5、运行成功后，浏览器中输入地址<a href="http://localhost:3000/" target="_blank" rel="external">http://localhost:3000/</a>访问项目成功页面：</p>
<p><img src="http://7xvmm0.com1.z0.glb.clouddn.com/Snip20180719_2.png" alt=""></p>
<p>6、打开项目的<code>package.json</code>文件，里面有一句</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"start"</span>: <span class="string">"node ./bin/www"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>说明以后我们启动项目只需要命令行中输入<code>npm start</code>或者<code>node ./bin/www</code>即可；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// app.js文件</span></div><div class="line"><span class="keyword">let</span> createError = <span class="built_in">require</span>(<span class="string">'http-errors'</span>);</div><div class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="keyword">let</span> cookieParser = <span class="built_in">require</span>(<span class="string">'cookie-parser'</span>);</div><div class="line"><span class="keyword">let</span> logger = <span class="built_in">require</span>(<span class="string">'morgan'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 引入路由文件</span></div><div class="line"><span class="keyword">let</span> indexRouter = <span class="built_in">require</span>(<span class="string">'./routes/index'</span>);</div><div class="line"><span class="keyword">let</span> usersRouter = <span class="built_in">require</span>(<span class="string">'./routes/users'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 生成express实例</span></div><div class="line"><span class="keyword">let</span> app = express();</div><div class="line"></div><div class="line"><span class="comment">// view engine setup</span></div><div class="line"><span class="comment">// 设置视图引擎</span></div><div class="line">app.set(<span class="string">'views'</span>, path.join(__dirname, <span class="string">'views'</span>));</div><div class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'ejs'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 使用引入的包文件</span></div><div class="line">app.use(logger(<span class="string">'dev'</span>));</div><div class="line">app.use(express.json());</div><div class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</div><div class="line">app.use(cookieParser());</div><div class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));</div><div class="line"></div><div class="line"><span class="comment">// 让用户访问路由找到对应的文件</span></div><div class="line">app.use(<span class="string">'/'</span>, indexRouter);</div><div class="line">app.use(<span class="string">'/users'</span>, usersRouter);</div><div class="line"></div><div class="line"><span class="comment">// catch 404 and forward to error handler</span></div><div class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  next(createError(<span class="number">404</span>));</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// error handler</span></div><div class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>) </span>&#123;</div><div class="line">  <span class="comment">// set locals, only providing error in development</span></div><div class="line">  res.locals.message = err.message;</div><div class="line">  res.locals.error = req.app.get(<span class="string">'env'</span>) === <span class="string">'development'</span> ? err : &#123;&#125;;</div><div class="line"></div><div class="line">  <span class="comment">// render the error page</span></div><div class="line">  res.status(err.status || <span class="number">500</span>);</div><div class="line">  res.render(<span class="string">'error'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = app;</div></pre></td></tr></table></figure>
<p><code>public</code>：用来存放静态资源文件，例如图片资源，<code>js</code>文件以及<code>css</code>文件；</p>
<p><code>routers</code>：存放所有路由文件</p>
<h4 id="到此为止"><a href="#到此为止" class="headerlink" title="到此为止"></a><code>到此为止</code></h4><p>通过上面的介绍了解了<code>express</code>生成器初始化一个项目，现在根据项目的基本配置往相应的文件夹中写入内容即可。</p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Node/" rel="tag">#-Node</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/29/20180529-vue生命周期钩子/" rel="next" title="vue生命周期钩子">
                <i class="fa fa-chevron-left"></i> vue生命周期钩子
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/06/05/20180605-ES6Proxy应用/" rel="prev" title="20180605-ES6Proxy应用">
                20180605-ES6Proxy应用 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://obkwv73yp.bkt.clouddn.com/huge.png"
               alt="袁媛" />
          <p class="site-author-name" itemprop="name">袁媛</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">13</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Node出现背景"><span class="nav-number">1.</span> <span class="nav-text">Node出现背景</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#背景"><span class="nav-number">1.1.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#三大特点"><span class="nav-number">1.2.</span> <span class="nav-text">三大特点</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#单线程"><span class="nav-number">1.2.1.</span> <span class="nav-text">单线程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#非阻塞I／O"><span class="nav-number">1.2.2.</span> <span class="nav-text">非阻塞I／O</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#事件驱动"><span class="nav-number">1.2.3.</span> <span class="nav-text">事件驱动</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Node学习之前"><span class="nav-number">2.</span> <span class="nav-text">Node学习之前</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#V8引擎"><span class="nav-number">2.1.</span> <span class="nav-text">V8引擎</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#web"><span class="nav-number">2.2.</span> <span class="nav-text">web</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#http协议"><span class="nav-number">2.3.</span> <span class="nav-text">http协议</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Node基础"><span class="nav-number">3.</span> <span class="nav-text">Node基础</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#模块化开发"><span class="nav-number">3.1.</span> <span class="nav-text">模块化开发</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#commonJS"><span class="nav-number">3.1.1.</span> <span class="nav-text">commonJS</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#AMD"><span class="nav-number">3.1.2.</span> <span class="nav-text">AMD</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CMD"><span class="nav-number">3.1.3.</span> <span class="nav-text">CMD</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模块使用"><span class="nav-number">3.2.</span> <span class="nav-text">模块使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#exports和require如何而来"><span class="nav-number">3.3.</span> <span class="nav-text">exports和require如何而来</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Node文件读写"><span class="nav-number">4.</span> <span class="nav-text">Node文件读写</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Buffer缓冲器"><span class="nav-number">4.1.</span> <span class="nav-text">Buffer缓冲器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#文件系统"><span class="nav-number">4.2.</span> <span class="nav-text">文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#写入文件"><span class="nav-number">4.2.1.</span> <span class="nav-text">写入文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#读取文件"><span class="nav-number">4.2.2.</span> <span class="nav-text">读取文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Node数据库"><span class="nav-number">5.</span> <span class="nav-text">Node数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MongoDB"><span class="nav-number">5.1.</span> <span class="nav-text">MongoDB</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装"><span class="nav-number">5.1.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#启动"><span class="nav-number">5.1.2.</span> <span class="nav-text">启动</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#小试牛刀"><span class="nav-number">5.1.3.</span> <span class="nav-text">小试牛刀</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#mongodb可视化工具"><span class="nav-number">5.1.4.</span> <span class="nav-text">mongodb可视化工具</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#mongoose基本操作"><span class="nav-number">5.1.5.</span> <span class="nav-text">mongoose基本操作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Node常用模块之URL模块"><span class="nav-number">6.</span> <span class="nav-text">Node常用模块之URL模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Node常用模块之HTTP模块"><span class="nav-number">7.</span> <span class="nav-text">Node常用模块之HTTP模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建http服务"><span class="nav-number">7.1.</span> <span class="nav-text">创建http服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Node中的路由"><span class="nav-number">7.2.</span> <span class="nav-text">Node中的路由</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#http发送请求"><span class="nav-number">7.3.</span> <span class="nav-text">http发送请求</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#http表单提交"><span class="nav-number">7.3.1.</span> <span class="nav-text">http表单提交</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#表单上传图片处理"><span class="nav-number">7.3.2.</span> <span class="nav-text">表单上传图片处理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Epress框架"><span class="nav-number">8.</span> <span class="nav-text">Epress框架</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装Express"><span class="nav-number">8.1.</span> <span class="nav-text">安装Express</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#基本使用"><span class="nav-number">8.2.</span> <span class="nav-text">基本使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#路由"><span class="nav-number">8.2.1.</span> <span class="nav-text">路由</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#托管静态文件"><span class="nav-number">8.2.2.</span> <span class="nav-text">托管静态文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#模版引擎"><span class="nav-number">8.2.3.</span> <span class="nav-text">模版引擎</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#应用生成器"><span class="nav-number">8.3.</span> <span class="nav-text">应用生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装-1"><span class="nav-number">8.3.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#初始化工程"><span class="nav-number">8.3.2.</span> <span class="nav-text">初始化工程</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#到此为止"><span class="nav-number">8.4.</span> <span class="nav-text">到此为止</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">袁媛</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  

</body>
</html>
